---
phase: 11-dns-cutover-decommission
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/server.rs
  - .do/app.yaml
  - render.yaml
autonomous: true

must_haves:
  truths:
    - "Rust server serves landing page HTML at GET /"
    - "DO app spec declares both 3gs.ai and api.3gs.ai as custom domains"
    - "render.yaml no longer exists in the working tree"
  artifacts:
    - path: "src/server.rs"
      provides: "Landing page route at /"
      contains: "route(\"/\""
    - path: ".do/app.yaml"
      provides: "Custom domain declarations for DO App Platform"
      contains: "domain: api.3gs.ai"
  key_links:
    - from: "src/server.rs"
      to: "docs/index.html"
      via: "include_str! macro embedding HTML at compile time"
      pattern: "include_str!"
    - from: ".do/app.yaml"
      to: "DigitalOcean App Platform"
      via: "domains section in app spec"
      pattern: "domains:"
---

<objective>
Add landing page route to the Rust server and prepare DO app spec for custom domain cutover.

Purpose: The Rust server currently has no route at `/`. To serve 3gs.ai from DO App Platform (not GitHub Pages), the server must return the landing page HTML. The DO app spec must also declare both custom domains so DO can provision SSL certificates.

Output: Updated server with landing page route, updated app spec with domains, render.yaml removed.
</objective>

<execution_context>
@/home/john/.claude/get-shit-done/workflows/execute-plan.md
@/home/john/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/10-digitalocean-provisioning/10-01-SUMMARY.md
@src/server.rs
@.do/app.yaml
@docs/index.html
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add landing page route serving docs/index.html at GET /</name>
  <files>src/server.rs</files>
  <action>
Add a GET `/` route to `build_router()` in src/server.rs that serves the landing page HTML.

Implementation:
1. At the top of server.rs, embed the landing page HTML at compile time:
   ```rust
   const LANDING_HTML: &str = include_str!("../docs/index.html");
   ```
2. Add a new handler function `landing_page_endpoint`:
   ```rust
   async fn landing_page_endpoint() -> (StatusCode, [(axum::http::HeaderName, &'static str); 1], &'static str) {
       (StatusCode::OK, [(header::CONTENT_TYPE, "text/html; charset=utf-8")], LANDING_HTML)
   }
   ```
3. Add the route to the Router in `build_router()`, before the `.layer(cors)` call:
   ```rust
   .route("/", get(landing_page_endpoint))
   ```

This uses `include_str!` to embed the HTML at compile time (same pattern used for registry.json in tests). No runtime file I/O needed. The handler does not need AppState so no State extractor is required.

Run `cargo build` to verify compilation. Run `cargo test` to verify no regressions.
  </action>
  <verify>
`cargo build` succeeds without errors. `cargo test` passes all existing tests. Manual test: `cargo run` then `curl http://localhost:3000/` returns HTML containing "Three Good Sources".
  </verify>
  <done>GET / returns the landing page HTML with Content-Type text/html, all existing tests still pass.</done>
</task>

<task type="auto">
  <name>Task 2: Update DO app spec with custom domains and remove render.yaml</name>
  <files>.do/app.yaml, render.yaml</files>
  <action>
1. Update `.do/app.yaml` to add a `domains` section. Add it at the top level (after `region`, before `services`):
   ```yaml
   domains:
     - domain: api.3gs.ai
       type: PRIMARY
       minimum_tls_version: "1.2"
     - domain: 3gs.ai
       type: ALIAS
       minimum_tls_version: "1.2"
   ```
   `api.3gs.ai` is PRIMARY (the main API domain). `3gs.ai` is ALIAS (additional domain serving same app). Both get automatic Let's Encrypt SSL from DO.

2. Remove `render.yaml` from git:
   ```bash
   git rm render.yaml
   ```
   Render is already decommissioned (user deleted in Phase 10). This file is no longer needed.

Do NOT add render.yaml to .gitignore — it was a project config file, not a secret. Removing it from git is sufficient.
  </action>
  <verify>
`cat .do/app.yaml` shows domains section with api.3gs.ai and 3gs.ai. `ls render.yaml` returns "No such file or directory". `git status` shows render.yaml deleted and .do/app.yaml modified.
  </verify>
  <done>DO app spec has both custom domains declared with TLS 1.2 minimum. render.yaml removed from git working tree.</done>
</task>

</tasks>

<verification>
1. `cargo build` succeeds
2. `cargo test` — all tests pass (no regressions)
3. `curl http://localhost:3000/` returns HTML with "Three Good Sources" in body
4. `.do/app.yaml` contains `domains:` section with both `api.3gs.ai` and `3gs.ai`
5. `render.yaml` does not exist in working tree
6. `git diff --cached` or `git status` shows render.yaml deleted
</verification>

<success_criteria>
- Rust server serves landing page at GET / (compile-time embedded HTML)
- DO app spec declares api.3gs.ai (PRIMARY) and 3gs.ai (ALIAS) with TLS 1.2
- render.yaml removed from git
- All existing tests pass
</success_criteria>

<output>
After completion, create `.planning/phases/11-dns-cutover-decommission/11-01-SUMMARY.md`
</output>
