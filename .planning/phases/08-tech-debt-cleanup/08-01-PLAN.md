---
phase: 08-tech-debt-cleanup
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/matcher/mod.rs
  - src/registry/mod.rs
  - src/matcher/scorer.rs
  - src/mcp/types.rs
  - src/mcp/error.rs
  - src/mcp/mod.rs
  - src/registry/error.rs
  - Cargo.toml
autonomous: true

must_haves:
  truths:
    - "cargo clippy --all-targets produces zero unused/dead_code warnings"
    - "cargo build succeeds after all dead code removals"
    - "All tests pass (cargo test) after each atomic commit"
    - "McpError enum no longer exists in codebase"
  artifacts:
    - path: "src/mcp/mod.rs"
      provides: "MCP module without error submodule"
      contains: "pub mod handler"
    - path: "src/matcher/mod.rs"
      provides: "Matcher module with clean exports"
      contains: "pub use scorer::match_query"
    - path: "src/registry/mod.rs"
      provides: "Registry module with clean exports"
      contains: "pub use types::Registry"
  key_links:
    - from: "src/mcp/handler.rs"
      to: "src/mcp/types.rs"
      via: "tool_result method usage"
      pattern: "tool_result is unused — verify handler.rs does NOT call it before removing"
    - from: "src/mcp/tools.rs"
      to: "src/matcher/mod.rs"
      via: "MatchError import"
      pattern: "use crate::matcher.*MatchError"
---

<objective>
Remove all dead code, unused imports, unused struct fields, and the unused McpError enum from the codebase, driven by cargo clippy and compiler warnings.

Purpose: Satisfy requirement CLEAN-01 (remove McpError enum) and clean up all compiler warnings before the dependency patch removal attempt in Plan 02.
Output: Warning-free codebase with each fix as a separate atomic commit.
</objective>

<execution_context>
@/home/john/.claude/get-shit-done/workflows/execute-plan.md
@/home/john/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/08-tech-debt-cleanup/08-RESEARCH.md
@.planning/phases/08-tech-debt-cleanup/08-CONTEXT.md
@Cargo.toml
@src/mcp/error.rs
@src/mcp/mod.rs
@src/mcp/types.rs
@src/matcher/mod.rs
@src/matcher/scorer.rs
@src/registry/mod.rs
@src/registry/error.rs
</context>

<tasks>

<task type="auto">
  <name>Task 1: Remove unused imports, fields, functions, and enum variants</name>
  <files>
    src/matcher/mod.rs
    src/registry/mod.rs
    src/matcher/scorer.rs
    src/mcp/types.rs
    src/registry/error.rs
  </files>
  <action>
Run `cargo clippy --all-targets -- -W unused -W dead-code 2>&1` to get the current warning list. Then fix each warning as a separate atomic commit (one commit per fix, each must build and pass tests independently).

Research identified these 7 warnings to address:

1. **Unused import MatchResult** (src/matcher/mod.rs:8): Change `pub use scorer::{match_query, MatchResult};` to `pub use scorer::match_query;`. First grep for `MatchResult` across the codebase to confirm it is only used internally within scorer.rs (where it is defined). The `match_query` function returns `MatchResult` so callers use it, but the re-export from mod.rs may be unused if all callers import from `scorer` directly or use `match_query` which returns the type.

2. **Unused imports in registry/mod.rs** (src/registry/mod.rs:8): The line `pub use types::{Category, Curator, Endorsement, Registry, Source, SourceType};` re-exports types that may not all be used externally. Grep for each type name to determine which are actually imported via `crate::registry::` paths vs. `crate::registry::types::` directly. Remove only the ones that are genuinely unused as re-exports. Keep types that are imported via `crate::registry::TypeName` elsewhere.

3. **Unused field `score`** (src/matcher/scorer.rs:14): The `score` field on `MatchResult` struct. Grep for `.score` usage across the codebase. If it IS used (e.g., in tests or tools.rs), keep it and add `#[allow(dead_code)]` or mark the warning as a false positive. If truly unused outside test assertions on the struct, remove it. Note: looking at the test code, `result.score` IS used in test assertions. Check if clippy considers test usage as "used" — if the warning persists despite test usage, add `#[allow(dead_code)]` to suppress.

4. **Unused function `tool_result`** (src/mcp/types.rs:90): The `JsonRpcResponse::tool_result` method. Grep for `tool_result` across the codebase. If no callers exist (handler.rs likely builds responses differently), remove the method entirely.

5. **Unused fields on InitializeParams** (src/mcp/types.rs:116): Fields `protocol_version`, `capabilities`, `client_info` on `InitializeParams`. These are deserialized from the MCP initialize request but may never be read. If the handler only deserializes them to validate the request structure but never accesses the fields, add `#[allow(dead_code)]` since these fields are part of the MCP protocol spec and should remain for correctness (they ARE used by serde deserialization even if not read programmatically).

6. **Unused enum variant `DuplicateSlug`** (src/registry/error.rs:21): Grep for `DuplicateSlug` usage. If never constructed anywhere, remove the variant. The loader may not check for duplicates since HashMap naturally deduplicates.

For each fix:
- Grep to verify the item is truly unused
- Make the edit
- Run `cargo build && cargo test`
- If both pass, commit with descriptive message: `refactor(module): remove unused X` with Co-Authored-By trailer
- If build or tests fail, revert and investigate

Order: Start with lowest risk (unused imports) and work up to unused fields/functions/variants. Commit after each individual fix.
  </action>
  <verify>
After all fixes committed:
- `cargo clippy --all-targets -- -W unused -W dead-code 2>&1` shows zero warnings for unused/dead code (warnings about the McpError enum will be addressed in Task 2)
- `cargo build` succeeds
- `cargo test` passes all tests
- `git log --oneline` shows separate commits for each fix
  </verify>
  <done>All clippy unused/dead_code warnings resolved except McpError (Task 2). Each fix is a separate atomic commit that independently builds and passes all tests.</done>
</task>

<task type="auto">
  <name>Task 2: Remove McpError enum and check for unused dependencies</name>
  <files>
    src/mcp/error.rs
    src/mcp/mod.rs
    Cargo.toml
  </files>
  <action>
**Part A: Remove McpError enum (CLEAN-01 requirement)**

1. Grep `McpError` across all `.rs` files to confirm it is only defined, never used:
   ```
   grep -r "McpError" --include="*.rs" src/
   ```
   Expected: Only definition in `src/mcp/error.rs` and `pub mod error` in `src/mcp/mod.rs`.

2. Delete the file `src/mcp/error.rs` entirely.

3. Remove `pub mod error;` from `src/mcp/mod.rs`.

4. Run `cargo build && cargo test` to verify.

5. Commit: `refactor(mcp): remove unused McpError enum` with body explaining this fulfills requirement CLEAN-01.

**Part B: Check for unused Cargo.toml dependencies**

1. Run `cargo machete 2>&1` to check for unused dependencies. If cargo-machete is not installed, do a manual check: grep each dependency name from Cargo.toml across the `src/` directory to see if it's actually imported/used.

2. Current dependencies to verify (19 direct):
   - anyhow, axum, dotenvy, envy, hex, pkarr, regex, schemars, serde, serde_json, stop-words, strsim, thiserror, tokio, tower-http, tracing, tracing-subscriber

3. For any dependency that is genuinely unused (not imported anywhere in src/ and not used transitively by the build), remove it from Cargo.toml.

4. Run `cargo build && cargo test` after each removal.

5. Commit any removals: `deps: remove unused X dependency`

**Important:** Do not remove dependencies that appear unused by grep but are actually used via proc macros (e.g., `serde` with derive, `thiserror`, `schemars`), features (e.g., `tokio` with full), or build configuration.
  </action>
  <verify>
- `grep -r "McpError" --include="*.rs" src/` returns no results
- `src/mcp/error.rs` does not exist
- `src/mcp/mod.rs` does not contain `pub mod error`
- `cargo build` succeeds
- `cargo test` passes all tests
- `cargo clippy --all-targets -- -W unused -W dead-code 2>&1` shows zero unused/dead_code warnings
  </verify>
  <done>McpError enum completely removed from codebase (CLEAN-01 fulfilled). Unused dependencies identified and removed if any found. Codebase is warning-free and all tests pass.</done>
</task>

</tasks>

<verification>
After both tasks complete:
1. `cargo clippy --all-targets -- -W unused -W dead-code 2>&1` produces zero unused/dead_code warnings
2. `cargo build` succeeds
3. `cargo test` passes all tests (115 test executions)
4. `grep -r "McpError" --include="*.rs" src/` returns empty (CLEAN-01)
5. `git log --oneline` shows separate atomic commits for each fix
6. No files contain `#[allow(dead_code)]` unless explicitly justified (protocol-required fields like InitializeParams)
</verification>

<success_criteria>
- Zero clippy dead_code/unused warnings
- McpError enum removed from codebase
- All tests pass
- Each fix is a separate atomic commit
- Codebase ready for dependency patch removal (Plan 02)
</success_criteria>

<output>
After completion, create `.planning/phases/08-tech-debt-cleanup/08-01-SUMMARY.md`
</output>
